{"id":"localbooru-0qr","title":"Tauri Migration: Linux Packaging","description":"Package Tauri app for Linux distribution.\n\n## Acceptance Criteria\n- AppImage builds successfully\n- .deb package for Debian/Ubuntu\n- .rpm package for Fedora\n- Bundled Python environment\n- GStreamer dependencies documented/bundled\n\n## Technical Notes\n- Use tauri-bundler\n- Consider Flatpak for easier dependency management\n- Document required system packages\n- Test on clean system installs","status":"closed","priority":3,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:56.325381499+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:47:00.095613845+01:00","closed_at":"2026-02-04T16:47:00.095613845+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-0qr","depends_on_id":"localbooru-haz","type":"blocks","created_at":"2026-02-04T14:55:03.87588199+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-0qr","depends_on_id":"localbooru-984","type":"blocks","created_at":"2026-02-04T14:55:03.905775688+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-0r1","title":"Directory location change","description":"make it so we can edit a directory to change its location, so if it was moved we can remap the directory to the new location.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:19:49.404681097+01:00","updated_at":"2026-01-22T20:24:35.328779823+01:00","closed_at":"2026-01-22T20:24:35.328779823+01:00","close_reason":"Implemented directory path editing feature"}
{"id":"localbooru-0vu","title":"Tauri Migration: VFR Video Handling","description":"Implement VFR (Variable Frame Rate) video support using GStreamer.\n\n## Acceptance Criteria\n- VFR videos play at correct speed (no audio desync)\n- Frame timing preserved\n- Smooth playback without stuttering\n- Works with timeline scrubbing\n\n## Technical Notes\n- GStreamer handles VFR natively better than browser\n- May need custom timestamp handling for seeking\n- Test with known VFR sources (phone videos, screen recordings)","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:45.989226563+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:35:40.921068176+01:00","closed_at":"2026-02-04T16:35:40.921068176+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-0vu","depends_on_id":"localbooru-4mn","type":"blocks","created_at":"2026-02-04T14:55:01.501430359+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-2om","title":"Implement data migration subsystem","description":"The entire data migration subsystem is a stub in v2. GET /settings/migration returns {current_mode: 'system', status: null}. Frontend calls 11 migration endpoints and gets 404 on all sub-routes:\n\nMISSING ENDPOINTS:\n- GET /settings/migration/directories — list watch dirs with image count and size for selective migration\n- POST /settings/migration/validate — dry-run validation (full or selective)\n- POST /settings/migration/start — start migration in background with SSE progress\n- GET /settings/migration/status — poll current migration progress\n- POST /settings/migration/cleanup — remove partial data from failed migration\n- POST /settings/migration/delete-source — delete source data after verified migration\n- POST /settings/migration/verify — verify migration completed successfully\n- GET /settings/migration/events — SSE stream for real-time migration progress\n- POST /settings/migration/import/validate — validate directory import\n- POST /settings/migration/import/start — start directory import with SSE progress\n\nMISSING EVENT BROADCASTER:\n- migration_events — v2's events.rs has migration events defined but no actual migration logic emits them\n\nThis is the system for migrating between per-directory DB mode and main DB mode, and for importing directories from other instances.","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:08:52.216621139+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.157929186+01:00","closed_at":"2026-02-16T13:01:39.157929186+01:00","close_reason":"Closed"}
{"id":"localbooru-2rp","title":"Fix task queue (concurrency, retry, tag guardian, dedup bug)","description":"v2's task_queue.rs has several gaps compared to v1:\n\n1. SERIAL PROCESSING — v2 processes one task at a time in a loop. v1 used configurable concurrency (asyncio.gather with N workers from settings). Should support parallel task processing.\n\n2. NO TASK RETRY — v2 marks tasks as failed immediately after first error. v1 retried up to 3 times with exponential backoff before marking failed.\n\n3. NO TAG GUARDIAN — v1 had a periodic background loop that found untagged images (no entries in image_tags) and re-queued tag tasks for them. This caught images that fell through the cracks during bulk imports. Completely absent from v2.\n\n4. NO GPU AUTO-PAUSE — v1 checked for active SVP/optical-flow/transcode streams and auto-paused the queue when GPU was busy. v2 has no GPU contention detection.\n\n5. TASK DEDUP BUG — v2 uses LIKE '%\"image_id\":N%' which can false-positive: image_id 1 matches image_id 10, 100, 1234, etc. v1 used boundary-aware patterns ('\"image_id\": N,' and '\"image_id\": N}') to avoid this.\n\n6. MISSING TASK HANDLERS — TASK_TAG and TASK_AGE_DETECT just log 'Skipping' and return. TASK_EXTRACT_METADATA only handles complete_import=true case (fast import completion), skips actual metadata extraction. No TASK_UPLOAD handler at all.","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:03:35.712666306+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.587858839+01:00","closed_at":"2026-02-16T12:48:33.587858839+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-2rp","depends_on_id":"localbooru-e7z","type":"blocks","created_at":"2026-02-16T12:13:26.87671076+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-2us","title":"Tauri Migration: Frontend IPC Porting","description":"Port all Electron IPC calls to Tauri invoke commands.\n\n## Context\nThe React frontend currently uses window.electronAPI to communicate with the Electron main process. This needs to be replaced with Tauri's invoke system.\n\n## Current electronAPI Methods (from preload.js)\nExamine electron/preload.js for the full list, including:\n- File system operations (read, write, glob)\n- Path operations (join, resolve, basename)\n- Dialog operations (open file, save file, select folder)\n- Shell operations (open external URL, show in folder)\n- Window operations (minimize, maximize, close)\n- App info (version, platform, isElectron)\n- Video streaming (transcode URLs, HLS paths)\n\n## Deliverables\n1. Create Tauri commands for each electronAPI method\n2. Create frontend wrapper that mimics electronAPI interface\n3. Ensure backward compatibility (same API shape)\n4. Handle platform differences (Linux paths vs Windows)\n\n## Implementation Strategy\n```javascript\n// frontend/src/tauri-api.js\nimport { invoke } from '@tauri-apps/api/core';\n\nexport const tauriAPI = {\n  readFile: (path) =\u003e invoke('read_file', { path }),\n  writeFile: (path, data) =\u003e invoke('write_file', { path, data }),\n  // ... etc\n};\n\n// For compatibility, expose as window.electronAPI\nwindow.electronAPI = tauriAPI;\n```\n\n## Files to Modify\n- frontend/src/api.js - Update API client\n- frontend/src/App.jsx - Platform detection\n- All components using window.electronAPI\n\n## Success Criteria\n- All frontend functionality works with Tauri backend\n- No references to window.electronAPI remain (or they're aliased)\n- File dialogs work correctly on Linux\n- External links open in system browser","status":"closed","priority":2,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:09.214292634+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.145694615+01:00","closed_at":"2026-02-04T14:55:14.145694615+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-2us","depends_on_id":"localbooru-bi6","type":"blocks","created_at":"2026-02-04T14:52:09.226720254+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-2us","depends_on_id":"localbooru-qzf","type":"blocks","created_at":"2026-02-04T14:52:09.251677434+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-2v6","title":"Tauri Migration: Video Controls Integration","description":"Connect React video controls UI to GStreamer player via Tauri commands.\n\n## Context\nLocalBooru has a custom video player UI with VLC-style controls:\n- Play/Pause toggle\n- Seek bar with preview thumbnails\n- Volume control with mute\n- Playback speed adjustment\n- Fullscreen toggle\n- Frame stepping (comma/period keys)\n- Loop toggle\n\n## Current Implementation\n- frontend/src/components/Lightbox/Lightbox.jsx - Main lightbox component\n- frontend/src/components/Lightbox/Lightbox.css - Styling\n- frontend/src/components/Lightbox/hooks/usePlaybackControls.js - Control logic\n\nThe controls currently manipulate an HTML5 \u003cvideo\u003e element via ref.\n\n## Deliverables\n1. Tauri commands for GStreamer control:\n   - gstreamer_play()\n   - gstreamer_pause()\n   - gstreamer_seek(position_ms)\n   - gstreamer_set_volume(0.0-1.0)\n   - gstreamer_set_rate(speed)\n   - gstreamer_get_position() -\u003e position_ms\n   - gstreamer_get_duration() -\u003e duration_ms\n\n2. Event system for playback state:\n   - on_position_changed\n   - on_state_changed (playing/paused/stopped)\n   - on_eos (end of stream)\n   - on_error\n\n3. Update usePlaybackControls.js to use Tauri commands instead of video element\n\n## Technical Notes\n- GStreamer position/duration queries return in nanoseconds\n- Need periodic polling or callback for position updates\n- State changes are async - handle transitions properly\n\n## Success Criteria\n- All existing controls work with GStreamer backend\n- Smooth seek bar updates during playback\n- Keyboard shortcuts work (space, arrow keys, comma/period)\n- Volume persists across videos","status":"closed","priority":2,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:28.991856705+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.155367344+01:00","closed_at":"2026-02-04T14:55:14.155367344+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-2v6","depends_on_id":"localbooru-f77","type":"blocks","created_at":"2026-02-04T14:52:09.273289516+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-2v6","depends_on_id":"localbooru-2us","type":"blocks","created_at":"2026-02-04T14:52:09.298596159+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-378","title":"Tauri Migration: SVP/Interpolation Pipeline","description":"Integrate SVP frame interpolation with GStreamer video playback.\n\n## Context\nLocalBooru supports SVP (SmoothVideo Project) style frame interpolation using VapourSynth. The current implementation:\n1. User enables interpolation in settings\n2. Python backend starts VapourSynth + FFmpeg pipeline\n3. Pipeline outputs HLS stream to temp directory\n4. Frontend plays HLS stream via hls.js\n\n## Current Implementation Files\n- api/services/transcode_stream.py - HLS transcoding service\n- api/routers/settings/video.py - Video settings API\n- frontend/src/components/Lightbox/hooks/useVideoStreaming.js - Streaming logic\n\n## How It Will Work with GStreamer\nGStreamer can consume HLS streams natively:\n```\nhlsdemux → decodebin → videoconvert → gtkwaylandsink\n```\n\nOr we could potentially integrate VapourSynth directly into GStreamer pipeline (advanced).\n\n## Deliverables\n1. GStreamer pipeline that consumes HLS streams\n2. Tauri command to start SVP pipeline (calls Python backend)\n3. Tauri command to get HLS stream URL\n4. Frontend integration - show interpolation status\n5. Smooth transition between original and interpolated playback\n\n## Technical Notes\n- HLS streams are served by Python backend on localhost\n- GStreamer's souphttpsrc or hlsdemux can fetch HLS\n- Need to handle pipeline state changes (loading → playing)\n- Consider latency - HLS has inherent delay\n\n## Success Criteria\n- Interpolated video plays smoothly in GStreamer\n- User can toggle interpolation on/off\n- No audio sync issues\n- Works with 24fps → 60fps interpolation","status":"closed","priority":2,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:21.276748954+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.150511662+01:00","closed_at":"2026-02-04T14:55:14.150511662+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-378","depends_on_id":"localbooru-f77","type":"blocks","created_at":"2026-02-04T14:52:09.347349789+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-378","depends_on_id":"localbooru-qzf","type":"blocks","created_at":"2026-02-04T14:52:09.376660253+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-3dg","title":"Fix tag category update API contract (query param vs JSON body)","description":"PATCH /tags/{tag_name}/category has a breaking API contract change:\n- v1: accepts category as a query parameter: ?category=artist\n- v2: accepts category as a JSON request body: {\"category\": \"artist\"}\n\nFrontend code calling with query params will get unexpected behavior. Should match v1's query param convention, or update frontend to match.\n\nAlso: error mapping in GET /tags/{tag_name} uses map_err(|_| NotFound) which masks real DB errors (schema mismatch, connection issues) as 404. Should specifically match rusqlite::Error::QueryReturnedNoRows for 404, and let other errors propagate as 500.","status":"closed","priority":1,"issue_type":"bug","owner":"megusta52@proton.me","created_at":"2026-02-16T12:02:16.326951957+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:30:16.615742321+01:00","closed_at":"2026-02-16T12:30:16.615742321+01:00","close_reason":"Closed"}
{"id":"localbooru-41m","title":"Tauri Migration: SVP/Interpolation Pipeline","description":"Integrate SVP or custom frame interpolation with GStreamer pipeline.\n\n## Acceptance Criteria\n- Frame interpolation toggleable in settings\n- SVP integration OR RIFE-ncnn fallback\n- Smooth 60fps+ output from 24fps sources\n- No visual artifacts at default settings\n\n## Technical Notes\n- GStreamer filter pipeline approach\n- Consider vapoursynth integration if SVP needed\n- RIFE-ncnn as fallback (GPU accelerated)\n- User-configurable interpolation ratio","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:48.950487132+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:25:56.663961721+01:00","closed_at":"2026-02-04T16:25:56.663961721+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-41m","depends_on_id":"localbooru-hbx","type":"blocks","created_at":"2026-02-04T14:55:02.197907091+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-41m","depends_on_id":"localbooru-eaj","type":"blocks","created_at":"2026-02-04T14:55:02.22831969+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-4mn","title":"Tauri Migration: GStreamer Video Player Prototype","description":"Prove that GStreamer can render video in Tauri on Wayland Linux.\n\n## Acceptance Criteria\n- Minimal Tauri app with GStreamer playback\n- Works on Wayland (not just X11)\n- Hardware decode functional\n- Can overlay transparent WebView on top\n\n## Technical Notes\n- Use gstreamer-rs bindings\n- Try gtkwaylandsink or wlshm approach\n- May need custom GTK widget integration\n- Reference: https://discourse.gstreamer.org/t/embedding-gstreamer-into-wayland-window/3661","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:40.631086614+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:10:22.316050783+01:00","closed_at":"2026-02-04T16:10:22.316050783+01:00","close_reason":"Completed GStreamer video player prototype for Tauri on Wayland. Key findings: GStreamer works with hardware acceleration (NVIDIA NVDEC), waylandsink provides native Wayland rendering, but WebView overlay requires separate approach (frame extraction via appsink or HTTP streaming). See GSTREAMER_WAYLAND.md for full details.","dependencies":[{"issue_id":"localbooru-4mn","depends_on_id":"localbooru-hbx","type":"blocks","created_at":"2026-02-04T14:55:01.0898368+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-5ix","title":"Add Cast/Chromecast subsystem","description":"The entire Chromecast/UPnP casting system is missing from v2. Frontend calls 6+ routes under /api/cast/* and gets 404:\n\nMISSING ROUTES:\n- GET /api/cast/devices — discover cast devices on network\n- POST /api/cast/devices/refresh — refresh device discovery\n- POST /api/cast/play — start casting media to a device\n- POST /api/cast/control — play/pause/seek/volume control\n- POST /api/cast/stop — stop casting\n- GET /api/cast/status — SSE stream for cast status updates\n\nMISSING SERVICES (from v1):\n- cast_discovery.py — network device discovery (Chromecast + UPnP)\n- cast_session.py — active casting session management\n- cast_media_server.py — local HTTP server for casting media to devices\n- cast_events broadcaster — SSE for cast status\n\nThis is a significant subsystem. Could be a Python sidecar addon.","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:08:11.534718789+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.159590154+01:00","closed_at":"2026-02-16T13:01:39.159590154+01:00","close_reason":"Closed"}
{"id":"localbooru-6s3","title":"Tauri Migration: Transcoding Pipeline","description":"Port video transcoding functionality to work with Tauri/GStreamer.\n\n## Context\nLocalBooru supports transcoding videos to different qualities (720p, 1080p, etc.) via FFmpeg. The transcoded output is served as HLS for streaming.\n\n## Current Implementation\n- api/routers/settings/video.py - Quality selection API\n- api/services/transcode_stream.py - FFmpeg transcoding service\n- Frontend requests transcode, backend generates HLS, frontend plays via hls.js\n\n## What Changes\nThe transcoding itself stays in Python/FFmpeg. Only the playback changes:\n- OLD: HLS stream → hls.js → HTML5 video\n- NEW: HLS stream → GStreamer hlsdemux → native playback\n\n## Deliverables\n1. Tauri command to request transcode at specific quality\n2. Tauri command to get transcode progress/status\n3. GStreamer pipeline for HLS playback (reuse from SVP task)\n4. Quality selector UI integration\n5. Cancel transcode functionality\n\n## Technical Notes\n- Transcode outputs to temp directory as HLS segments\n- Python backend serves HLS via FastAPI\n- GStreamer needs to poll/refresh HLS playlist\n- Handle transcode failures gracefully\n\n## Files to Reference\n- api/services/transcode_stream.py\n- frontend/src/components/Lightbox/hooks/useVideoStreaming.js\n\n## Success Criteria\n- User can select video quality (original, 720p, 1080p, etc.)\n- Transcode progress is shown in UI\n- Transcoded video plays smoothly in GStreamer\n- Can cancel in-progress transcode","status":"closed","priority":2,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:57.616559321+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.153047085+01:00","closed_at":"2026-02-04T14:55:14.153047085+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-6s3","depends_on_id":"localbooru-f77","type":"blocks","created_at":"2026-02-04T14:52:09.402095354+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-6s3","depends_on_id":"localbooru-qzf","type":"blocks","created_at":"2026-02-04T14:52:09.42816615+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-7xl","title":"Tauri Migration: VFR Video Handling","description":"Ensure VFR (Variable Frame Rate) videos play correctly with GStreamer.\n\n## Context\nThe primary motivation for this entire Tauri migration is to solve VFR video playback issues. HTML5 video in browsers mishandles VFR, causing stuttering and A/V desync.\n\n## What is VFR?\nVariable Frame Rate videos have non-constant time between frames:\n- Screen recordings often have VFR\n- Some phone cameras produce VFR\n- Game recordings with variable FPS\n\n## Why GStreamer Solves This\nGStreamer's video pipeline handles frame timestamps properly:\n- Each frame has a PTS (Presentation Time Stamp)\n- GStreamer respects these timestamps during playback\n- Hardware decoders preserve timing information\n\n## Current Workaround (to be replaced)\nThe Electron app detects VFR and transcodes to CFR (Constant Frame Rate) via FFmpeg:\n- api/services/transcode_stream.py handles this\n- Adds latency and uses CPU\n- Transcoding 404 bug is currently broken anyway\n\n## Deliverables\n1. Test suite of VFR video files for verification\n2. Confirm GStreamer plays VFR files correctly (no transcode needed!)\n3. Remove VFR detection logic from frontend (useVideoStreaming.js)\n4. Remove or simplify transcode fallback code\n5. Document which container/codec combinations work\n\n## Test Cases\n- MKV with VFR H.264\n- MP4 with VFR H.265/HEVC  \n- WebM with VFR VP9\n- Screen recording with variable framerate\n- 24fps/30fps mixed content\n\n## Success Criteria\n- VFR videos play without stuttering\n- Audio stays in sync throughout playback\n- No automatic transcoding triggered\n- Seeking works correctly in VFR content","status":"closed","priority":2,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:50.589549141+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.148092248+01:00","closed_at":"2026-02-04T14:55:14.148092248+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-7xl","depends_on_id":"localbooru-f77","type":"blocks","created_at":"2026-02-04T14:52:09.322869462+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-8ds","title":"Add missing image routes (upload, preview frames)","description":"Image endpoints that exist in v1 but are completely absent from v2:\n\n- POST /images/upload — manual image upload via multipart form data with auto_tag parameter. Saves to temp file, calls import_image(), returns result.\n- GET /images/{id}/preview-frames — returns list of video preview frame URLs, triggers background frame generation if not yet done. Response: {frames: [...urls], is_video, count, generating}\n- GET /images/{id}/preview-frame/{n} — serves a specific video preview frame image by frame index (0-7), looked up by file_hash.\n\nAlso missing from DELETE /images/{id}:\n- Video preview frames not cleaned up on image delete (v1 calls delete_preview_frames(file_hash))","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:01:45.820810519+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.590041631+01:00","closed_at":"2026-02-16T12:48:33.590041631+01:00","close_reason":"Closed"}
{"id":"localbooru-984","title":"Tauri Migration: Transcoding Pipeline","description":"Implement on-the-fly transcoding for incompatible formats.\n\n## Acceptance Criteria\n- Transcode non-native formats to playable format\n- HLS streaming for large files\n- Progress indication\n- Caching of transcoded segments\n\n## Technical Notes\n- GStreamer can handle transcoding directly\n- May not need FFmpeg subprocess anymore\n- Consider hardware encode (NVENC, VAAPI)\n- Cache management for disk space","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:51.50667459+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:26:40.388753595+01:00","closed_at":"2026-02-04T16:26:40.388753595+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-984","depends_on_id":"localbooru-4mn","type":"blocks","created_at":"2026-02-04T14:55:02.726705112+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-9wx","title":"Fix directory watcher gaps (parent watch, refresh, move handling)","description":"v2's directory_watcher.rs is missing several features from v1:\n\n1. PARENT DIRECTORY WATCHER — v1's ParentDirectoryEventHandler watches parent directories for new subdirectory creation, auto-adds child dirs with sibling settings, creates per-dir DB, queues scan, starts watcher. Completely missing in v2.\n\n2. NO refresh() METHOD — v1 could re-read DB and add/remove watches for changed directories. v2 has no refresh capability — once started, watches can only be added/removed individually. This means PATCH updates to directory enabled/recursive are not reflected in the watcher until restart.\n\n3. FILE MOVE HANDLING — v1 has explicit on_moved handler that imports the dest_path. v2 treats Modify events from untracked files as new imports, handling renames indirectly. No explicit Rename/Move event handling.\n\n4. STARTUP SCAN ISSUES:\n   - Doesn't check if directory already has a pending scan_directory task in task queue (v1 skipped these)\n   - Doesn't update last_scanned_at after startup scan\n   - Always uses recursive walkdir regardless of directory's recursive flag\n\n5. NO IMPORT RETRY — v1 retried imports 3 times with backoff on DB lock errors. v2 does not retry.\n\n6. NO AUTO-TAG FLAG — v1 passed directory.auto_tag to importer. v2 importer doesn't take an auto_tag parameter.","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:03:53.919447542+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.590814318+01:00","closed_at":"2026-02-16T12:48:33.590814318+01:00","close_reason":"Closed"}
{"id":"localbooru-ao6","title":"Fix password hashing and login security","description":"CRITICAL SECURITY: (1) Password hashing in users.rs uses std::collections::hash_map::DefaultHasher which is NOT cryptographic - must use proper PBKDF2/bcrypt/argon2. (2) Salt generation uses SystemTime::subsec_nanos() % 256 giving very low entropy - must use cryptographically secure RNG. (3) No login rate limiting - brute force possible. v1 had 5 attempts per IP per 15 minutes. (4) Login failure returns HTTP 400 instead of 401 - wrong semantics for auth failure.","status":"closed","priority":0,"issue_type":"bug","owner":"megusta52@proton.me","created_at":"2026-02-16T12:00:35.196189554+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:30:16.613617269+01:00","closed_at":"2026-02-16T12:30:16.613617269+01:00","close_reason":"Closed"}
{"id":"localbooru-as3","title":"Change default auth_required_level from none to local_network","description":"## Context\nThe default network settings at `api/routers/settings.py:91` set `auth_required_level: none` which means no authentication by default. This is insecure.\n\n## Requirements\n1. Change default `auth_required_level` from `\"none\"` to `\"local_network\"`\n2. This means auth will be required when accessing from local network or public internet\n3. Localhost access will remain unauthenticated by default\n\n## Files to modify\n- `api/routers/settings.py` - line 91, change default value\n\n## Notes\n- This is a simple one-line change\n- Existing users with explicit settings won't be affected\n- New installations will be more secure by default\n- Depends on: auth middleware being implemented first (otherwise this setting still does nothing)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T18:04:53.703907961+01:00","updated_at":"2026-01-19T18:09:09.04830642+01:00","closed_at":"2026-01-19T18:09:09.04830642+01:00"}
{"id":"localbooru-b2p","title":"Add missing network/auth services (Tailscale, TLS certs, JWT auth, rate limiting)","description":"Several network and auth services from v1 have no v2 equivalent:\n\n1. TAILSCALE INTEGRATION — tailscale.py service for remote access configuration. No v2 equivalent.\n\n2. TLS CERTIFICATE MANAGEMENT — certificate.py service for managing TLS certs. No v2 equivalent.\n\n3. JWT AUTH SERVICE — v1's auth.py handled JWT token creation/validation for user authentication. v2's access_control.rs only does IP classification (localhost/local_network/public), not user-level auth with JWT tokens.\n\n4. RATE LIMITING — v1's rate_limit.py provided rate limiting (e.g. 5 failed login attempts per IP per 15 minutes). No v2 equivalent at all. Related to the security issue in localbooru-ao6.\n\n5. NETWORK SERVICE — v1's network.py service handled network detection and binding. v2 has NetworkSettings route but no standalone network service.\n\n6. POST /api/network/verify-handshake — route exists in v2 but always returns 400 ('not yet available in v2'). SSL pinning verification is broken.","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:09:21.265745211+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.155640975+01:00","closed_at":"2026-02-16T13:01:39.155640975+01:00","close_reason":"Closed"}
{"id":"localbooru-bb9","title":"make svp enable/disable refresh video so that it switched effectively.","status":"tombstone","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-01-27T12:32:15.494705342+01:00","created_by":"DonutsDelivery","updated_at":"2026-01-29T14:15:12.121705556+01:00","deleted_at":"2026-01-29T14:15:12.121705556+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"localbooru-bi6","title":"Tauri Migration: Project Setup","description":"Initialize Tauri v2 project structure for LocalBooru migration IN A NEW DIRECTORY.\n\n## Context\nLocalBooru is currently an Electron app with:\n- React frontend (Vite)\n- Python FastAPI backend for image/video processing\n- FFmpeg/VapourSynth for video transcoding and SVP interpolation\n\nWe are migrating to Tauri for native video playback via GStreamer on Linux/Wayland.\n\n## IMPORTANT: New Directory Structure\nCreate the Tauri port in a NEW directory to keep it separate from the Electron app:\n\n```\nlocalbooru/              # Existing Electron app (keep as-is)\n├── electron/\n├── frontend/\n├── api/\n└── ...\n\nlocalbooru-tauri/        # NEW Tauri port directory\n├── src-tauri/           # Rust backend\n│   ├── Cargo.toml\n│   ├── tauri.conf.json\n│   └── src/\n│       └── main.rs\n├── frontend/            # Copy/link from existing\n├── api/                 # Copy/link from existing\n└── package.json         # New Tauri-specific package.json\n```\n\n## Deliverables\n1. Create new directory: ~/Programs/Claude Projects/localbooru-tauri/\n2. Initialize Tauri v2 project with `npm create tauri-app@latest`\n3. Configure Cargo.toml with dependencies (tauri, gstreamer-rs, etc.)\n4. Configure tauri.conf.json for Linux (GTK/WebKitGTK)\n5. Copy or symlink frontend/ directory from original\n6. Copy or symlink api/ directory from original\n7. Basic window that loads the React frontend\n\n## Technical Notes\n- Tauri v2 uses Rust for backend logic\n- On Linux, Tauri uses WebKitGTK (GTK3-based)\n- Need to preserve ability to spawn Python backend process\n- Frontend at frontend/dist/ should load in Tauri window\n- Keep Electron app functional for comparison/fallback\n\n## Success Criteria\n- 'cd localbooru-tauri \u0026\u0026 npm run tauri dev' launches app\n- React frontend visible in Tauri window\n- No console errors from Tauri initialization\n- Original Electron app still works independently","status":"closed","priority":1,"issue_type":"epic","owner":"megusta52@proton.me","created_at":"2026-02-04T14:50:40.897794288+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.135997199+01:00","closed_at":"2026-02-04T14:55:14.135997199+01:00","close_reason":"Duplicates - using newly created task issues instead"}
{"id":"localbooru-bn0","title":"make encoder work without svp.","status":"tombstone","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-01-27T12:31:49.985964937+01:00","created_by":"DonutsDelivery","updated_at":"2026-01-29T14:15:11.217386133+01:00","deleted_at":"2026-01-29T14:15:11.217386133+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"localbooru-cho","title":"Add Whisper subtitle streaming system","description":"The entire Whisper subtitle generation system is missing from v2. Frontend calls these endpoints and gets 404:\n\nMISSING ENDPOINTS:\n- POST /settings/whisper/install — install faster-whisper via pip in background\n- POST /settings/whisper/generate — start subtitle generation for a file, returns stream_id + vtt_url + events_url\n- POST /settings/whisper/stop — stop active subtitle generation\n- GET /settings/whisper/vtt/{stream_id}/subtitles.vtt — serve the growing VTT file\n- GET /settings/whisper/events/{stream_id} — SSE stream for subtitle cue data\n\nMISSING SERVICE:\n- whisper_subtitle_stream.py equivalent — real-time Whisper ASR subtitle generation for video\n\nMISSING EVENT BROADCASTER:\n- subtitle_events — v1 had a dedicated SSE broadcaster for subtitle generation progress. v2's events.rs has no equivalent.\n\nThis could be implemented as a Python sidecar addon (like optical-flow/SVP) with bridge routes in Rust.","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:07:58.85584446+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.160415824+01:00","closed_at":"2026-02-16T13:01:39.160415824+01:00","close_reason":"Closed"}
{"id":"localbooru-dlz","title":"Add SVP web video and ML model management routes","description":"Missing addon-adjacent routes:\n\nSVP WEB VIDEO (yt-dlp integration):\n- POST /settings/svp/web/play — download web video via yt-dlp, start SVP stream\n- GET /settings/svp/web/status/{download_id} — poll yt-dlp download progress\n- GET /settings/svp/web/drm-check — check if URL is DRM-protected or live-stream\n- Requires web_video_downloader.py service (yt-dlp wrapper) — absent from v2\n\nML MODEL MANAGEMENT:\n- GET /settings/models — list all ML model download statuses\n- POST /settings/models/download — trigger model download for a named model\n- GET /settings/models/{model_name}/progress — poll download progress\n- Requires model_downloader.py service — absent from v2","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:09:04.796734572+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.157094488+01:00","closed_at":"2026-02-16T13:01:39.157094488+01:00","close_reason":"Closed"}
{"id":"localbooru-e7z","title":"Add metadata extraction service (A1111/ComfyUI prompts, Danbooru tags)","description":"v2 has NO metadata extraction — AI image generation parameters are never parsed or saved. v1 had a full metadata_extractor.py service.\n\nMISSING FUNCTIONALITY:\n- extract_png_text_chunks() — reads tEXt/iTXt PNG chunks\n- parse_a1111_metadata() — parses Automatic1111 'parameters' chunk into prompt, negative_prompt, steps, sampler, CFG scale, seed, model name\n- parse_comfyui_metadata() — parses ComfyUI prompt/workflow JSON using configured node IDs\n- discover_comfyui_nodes() — scans image to list all text-containing nodes for UI configuration\n- has_comfyui_metadata()/has_a1111_metadata() — format detection\n- extract_and_save_metadata() — saves extracted fields to DB (prompt, negative_prompt, model_name, sampler, seed, steps, cfg_scale)\n- Danbooru tag extraction: downloads danbooru tag list (cached weekly), tokenizes SD prompt, finds matching tags, inserts as image_tags\n- extract_and_save_metadata_with_tags() — combined pipeline\n\nv2's task_queue.rs has a TASK_EXTRACT_METADATA handler that says 'deferred to later phase' and does nothing when complete_import is false. The import flow also never enqueues metadata tasks (v1 enqueued on every import with ComfyUI node IDs from directory config).\n\nThis should be implemented as a native Rust service — no Python sidecar needed since it's just PNG chunk parsing and string manipulation.","status":"closed","priority":1,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:02:36.150462846+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:41:25.002758447+01:00","closed_at":"2026-02-16T12:41:25.002758447+01:00","close_reason":"Closed"}
{"id":"localbooru-eaj","title":"Tauri Migration: Python Backend Bridge","description":"Create Tauri commands that spawn/manage the Python FastAPI backend.\n\n## Acceptance Criteria\n- Tauri command to spawn Python backend process\n- Health check / readiness detection\n- Graceful shutdown on app close\n- Port allocation (avoid conflicts)\n- Backend process lifecycle tied to app\n\n## Technical Notes\n- Mirror existing Electron backendManager.js functionality\n- Use tauri::process::Command for subprocess management\n- Consider sidecar approach for bundled Python","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:37.621491643+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T15:37:59.483042575+01:00","closed_at":"2026-02-04T15:37:59.483042575+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-eaj","depends_on_id":"localbooru-hbx","type":"blocks","created_at":"2026-02-04T14:55:01.066896816+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-edp","title":"Add addon install bridge routes (age-detection, whisper, cast)","description":"Several addon-dependent features have config/status routes in v2 but lack the install trigger endpoint. The frontend calls these and gets 404:\n\nMISSING INSTALL ENDPOINTS:\n- POST /settings/age-detection/install — v1 triggered pip install of torch/transformers/ultralytics etc. v2 has GET /age-detection/status and POST /age-detection/toggle but no install. Should bridge to addon manager's install_addon().\n- POST /settings/cast/install — v1 installed pychromecast/async-upnp-client/aiohttp. v2 has GET/POST /cast config but no install bridge.\n\nMISSING LIBRARY ENDPOINTS (depend on addons):\n- POST /library/tag-untagged — queues tag tasks for all untagged images. Frontend calls this, gets 404.\n- POST /library/detect-ages — queues age detection for images. Frontend calls this, gets 404.\n\nThese should be simple bridge routes that call addon_manager.install_addon(id) or enqueue tasks to the task_queue.","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:05:05.160317513+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.592340271+01:00","closed_at":"2026-02-16T12:48:33.592340271+01:00","close_reason":"Closed"}
{"id":"localbooru-f40","title":"Add missing ComfyUI directory config routes","description":"ComfyUI-specific directory management endpoints are missing from v2, and the frontend ComfyUIConfigModal.jsx calls them (also with wrong URL prefix - missing /api):\n\nMISSING ENDPOINTS:\n- GET /directories/{id}/comfyui-nodes — scans sample images to auto-discover ComfyUI node types\n- PATCH /directories/{id}/comfyui-config — updates comfyui_prompt_node_ids, comfyui_negative_node_ids, metadata_format on a directory\n- POST /directories/{id}/reextract-metadata — queues metadata re-extraction for all images using current ComfyUI config\n\nFRONTEND BUG:\n- ComfyUIConfigModal.jsx uses relative paths without /api prefix (e.g. fetch(`/directories/${id}/comfyui-nodes`) instead of fetch(`/api/directories/${id}/comfyui-nodes`))","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:01:15.923641033+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.589254247+01:00","closed_at":"2026-02-16T12:48:33.589254247+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-f40","depends_on_id":"localbooru-e7z","type":"blocks","created_at":"2026-02-16T12:13:17.013308326+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-f77","title":"Tauri Migration: GStreamer Video Player Prototype","description":"Build GStreamer video player that works on Linux Wayland with GTK integration.\n\n## Context\nHTML5 video in browsers cannot handle VFR (Variable Frame Rate) videos properly. We need native video playback via GStreamer which handles VFR natively and supports hardware decoding.\n\nTauri on Linux uses WebKitGTK (GTK3-based), so we can integrate GStreamer's GTK sinks.\n\n## Why GStreamer (not mpv/libmpv)\n- Window embedding (--wid) doesn't work on Wayland\n- mpv's render API requires complex buffer transfer to WebView\n- GStreamer has native GTK sinks (gtkwaylandsink, gtk4paintablesink)\n- GStreamer integrates naturally with GTK widget tree\n\n## Deliverables\n1. Minimal Tauri app with GStreamer video playback\n2. GStreamer pipeline: filesrc → decodebin → videoconvert → gtkwaylandsink\n3. Video renders in GTK surface within Tauri window\n4. Basic controls: play, pause, seek, volume\n5. Works on Wayland (primary) and X11 (fallback)\n\n## Technical Implementation\n```rust\n// Pseudo-code structure\nuse gstreamer as gst;\nuse gstreamer_video as gst_video;\n\nfn create_pipeline(file_path: \u0026str) -\u003e gst::Pipeline {\n    // filesrc ! decodebin ! videoconvert ! gtkwaylandsink\n}\n```\n\n## Dependencies\n- gstreamer-rs (Rust bindings)\n- gstreamer-video-rs\n- gst-plugins-base, gst-plugins-good, gst-plugins-bad\n\n## Success Criteria\n- Video plays in Tauri window on Wayland session\n- No window embedding issues (no separate windows)\n- Smooth playback of VFR video files\n- Controls work from JavaScript/React side","status":"closed","priority":1,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:00.544804062+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.143121402+01:00","closed_at":"2026-02-04T14:55:14.143121402+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-f77","depends_on_id":"localbooru-bi6","type":"blocks","created_at":"2026-02-04T14:52:09.20395636+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-ffo","title":"Add settings validation and fix status endpoint stubs","description":"v2 settings routes accept any JSON with no validation, and several status endpoints return hardcoded stubs:\n\nMISSING VALIDATION (all POST settings endpoints):\n- POST /optical-flow — v1 clamps target_fps to 15-120, validates quality/shader values. v2 accepts anything.\n- POST /svp — v1 clamps target_fps to 15-144, validates shader against [1,2,11,13,21,23]. v2 accepts anything.\n- POST /video-playback — v1 clamps auto_advance_delay to 1-30. v2 accepts anything.\n- POST /whisper — v1 validates model_size, task, device, compute_type, subtitle_style, clamps multiple numeric fields. v2 accepts anything.\n\nHARDCODED STATUS STUBS:\n- GET /optical-flow — returns hardcoded {any_backend_available: false, everything false}. Should bridge to addon sidecar for live GPU/backend detection.\n- GET /svp — returns hardcoded stub. Should bridge to addon sidecar for live VapourSynth/SVPflow/vspipe availability. Also missing 'options' block (algorithms, block_sizes, pel_options, mask_area).\n- GET /whisper — returns hardcoded {faster_whisper_installed: false, cuda_available: false}. Should check addon sidecar status.\n- GET / (all settings) — missing nested age_detection status object with dependency details, install progress.\n\nQUALITY PRESET DIFFERENCES:\n- Missing '1080p_enhanced' preset (20M bitrate)\n- 480p bitrate differs: v1=4M, v2=1536K\n- No 'no upscaling' guard: v1 returns 'original' if source is smaller than preset. v2 doesn't check.","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:04:49.039195804+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.591573568+01:00","closed_at":"2026-02-16T12:48:33.591573568+01:00","close_reason":"Closed"}
{"id":"localbooru-haz","title":"Tauri Migration: Video Controls Integration","description":"Connect WebView UI controls to GStreamer video player.\n\n## Acceptance Criteria\n- Play/pause from HTML controls\n- Seek bar with preview thumbnails\n- Volume control\n- Fullscreen toggle\n- Playback speed control\n- Quality selector (if transcoding)\n\n## Technical Notes\n- Tauri commands for each control action\n- Event stream from Rust for time updates\n- Consider tauri-plugin-event for real-time updates","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:54.162123071+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:41:49.830537485+01:00","closed_at":"2026-02-04T16:41:49.830537485+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-haz","depends_on_id":"localbooru-pad","type":"blocks","created_at":"2026-02-04T14:55:03.34498266+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-haz","depends_on_id":"localbooru-0vu","type":"blocks","created_at":"2026-02-04T14:55:03.375297918+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-hbx","title":"Tauri Migration: Project Setup","description":"Set up the Tauri project structure alongside the existing Electron app.\n\n## Acceptance Criteria\n- Initialize Tauri project with cargo-tauri\n- Configure for coexistence with Electron (can run either)\n- Set up Rust workspace structure\n- Add basic window creation\n- Document build/run commands\n\n## Technical Notes\n- Use Tauri 2.x (latest stable)\n- Keep frontend in same location (shared between Electron/Tauri during migration)\n- Configure for Linux target initially","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:34.825582769+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T15:11:35.749421083+01:00","closed_at":"2026-02-04T15:11:35.749421083+01:00","close_reason":"Closed"}
{"id":"localbooru-hg4","title":"Fix SQL injection in image list import_source filter","description":"SQL INJECTION: In images/list.rs:345, the import_source value is string-interpolated into SQL via format\\!(\"i.import_source = '{}'\", key.replace('\\'', \"''\")). Manual single-quote escaping is fragile. Must use parameterized queries instead.","status":"closed","priority":0,"issue_type":"bug","owner":"megusta52@proton.me","created_at":"2026-02-16T12:00:46.138471906+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:30:16.614948394+01:00","closed_at":"2026-02-16T12:30:16.614948394+01:00","close_reason":"Closed"}
{"id":"localbooru-ilf","title":"gallery count is broken in the side panel, always showing 0 images.","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-01-24T05:28:12.816309967+01:00","created_by":"DonutsDelivery","updated_at":"2026-01-24T07:53:38.98323208+01:00","closed_at":"2026-01-24T07:53:38.98323208+01:00","close_reason":"Fixed library stats to query per-directory databases instead of empty main Image table"}
{"id":"localbooru-js7","title":"Fix importer gaps (perceptual hash, file timestamps, thumbnail quality)","description":"v2's importer.rs is missing several features from v1's importer.py:\n\n1. PERCEPTUAL HASH — v1 calculates imagehash.phash() (DCT-based) and stores in perceptual_hash column. v2 never calculates or stores it. DB column exists but is always NULL. This breaks visual deduplication.\n\n2. FILE TIMESTAMPS — v1 stores file_created_at and file_modified_at from os.stat() on import. v2 only stores created_at (import time), never reads filesystem timestamps.\n\n3. THUMBNAIL QUALITY:\n   - v1 sets WebP quality=85, method=0 (fastest encoding). v2 uses library defaults (unspecified quality).\n   - v1 handles RGBA/palette images by compositing onto white RGB background. v2 calls to_rgb8() directly which may render incorrectly for transparent/palette images.\n   - v1 uses JPEG draft mode (img.draft(None, (size,size))) for memory-efficient JPEG thumbnail generation. No v2 equivalent.\n\n4. MAIN DB LEGACY IMPORT PATH — v1 has _import_to_main_db() for manual uploads without a directory_id. v2's import_image() requires directory_id, so manual uploads have no import path.\n\n5. RACE CONDITION HANDLING — v1 retries on IntegrityError/OperationalError with backoff. v2 lets rusqlite errors propagate. Also v1 has safe_enqueue_task() with 3-attempt retry for DB locks.","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:03:00.382303652+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:41:25.00401914+01:00","closed_at":"2026-02-16T12:41:25.00401914+01:00","close_reason":"Closed"}
{"id":"localbooru-nmb","title":"Tauri Migration: Linux Packaging","description":"Configure Tauri packaging for Linux distribution formats.\n\n## Context\nLocalBooru currently packages for Linux using electron-builder:\n- AppImage (primary)\n- .deb package\n- .rpm package\n- .zip archive\n\nTauri uses different packaging tools but supports similar formats.\n\n## Current Electron Packaging\nSee package.json 'build.linux' section:\n- Bundles python-venv-linux for Python runtime\n- Bundles api/ directory for Python code\n- Bundles frontend/dist/ for web assets\n- Includes tagger models\n\n## Deliverables\n1. tauri.conf.json bundle configuration\n2. AppImage generation\n3. .deb package generation\n4. Bundled Python environment (or system Python detection)\n5. Desktop entry with icon\n6. File associations (.booru files if applicable)\n\n## Technical Considerations\n- Tauri apps are much smaller than Electron (~10MB vs ~150MB base)\n- Still need to bundle Python + dependencies for processing\n- GStreamer plugins should use system libraries (not bundled)\n- Need to handle missing GStreamer plugins gracefully\n\n## Dependencies to Bundle\n- Python virtual environment with:\n  - FastAPI, uvicorn\n  - onnxruntime for AI tagging\n  - vapoursynth for video processing\n- FFmpeg binary (or rely on system)\n- Model files for tagger\n\n## Success Criteria\n- AppImage runs on fresh Arch/Ubuntu/Fedora install\n- .deb installs correctly on Debian/Ubuntu\n- App icon appears in system menu\n- Bundled Python environment works\n- Reasonable file size (\u003c100MB without models)","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:51:37.648211351+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.157769293+01:00","closed_at":"2026-02-04T14:55:14.157769293+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-nmb","depends_on_id":"localbooru-2v6","type":"blocks","created_at":"2026-02-04T14:52:09.459263787+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-nmb","depends_on_id":"localbooru-7xl","type":"blocks","created_at":"2026-02-04T14:52:09.483638022+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-nmb","depends_on_id":"localbooru-378","type":"blocks","created_at":"2026-02-04T14:52:09.509813726+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-nmb","depends_on_id":"localbooru-6s3","type":"blocks","created_at":"2026-02-04T14:52:09.53609195+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-p6m","title":"Fix collections response shape and API contract","description":"Collections routes have API contract mismatches between v1 and v2:\n\n1. GET /{collection_id} returns only image_ids (integers) instead of full image objects. v1 returned full objects with id, filename, file_hash, width, height, file_size, duration, rating, is_favorite, view_count, url, thumbnail_url, file_path. Frontend likely expects hydrated objects.\n\n2. PATCH /{id}/items/reorder changed to POST in v2 — HTTP method mismatch causes 405 for frontend calls using PATCH.\n\n3. GET /collections/ list response missing cover_thumbnail_url field — v1 returned it by looking up the cover image's thumbnail. v2 only returns cover_image_id, so frontend can't display collection cover thumbnails without an extra fetch.","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:01:58.969012626+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:30:16.616569106+01:00","closed_at":"2026-02-16T12:30:16.616569106+01:00","close_reason":"Closed"}
{"id":"localbooru-pad","title":"Tauri Migration: Frontend IPC Porting","description":"Replace Electron IPC calls with Tauri commands in the frontend.\n\n## Acceptance Criteria\n- Replace all window.electron.* calls with Tauri invoke\n- Update preload script equivalent (if needed)\n- Window control (minimize, maximize, close)\n- File system access through Tauri\n- All existing frontend features work\n\n## Technical Notes\n- Use @tauri-apps/api package\n- May need to create Tauri commands for each Electron IPC handler\n- Consider compatibility layer for gradual migration","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-04T14:54:43.474052057+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T16:18:37.176324026+01:00","closed_at":"2026-02-04T16:18:37.176324026+01:00","close_reason":"Closed","dependencies":[{"issue_id":"localbooru-pad","depends_on_id":"localbooru-hbx","type":"blocks","created_at":"2026-02-04T14:55:01.214602547+01:00","created_by":"DonutsDelivery"},{"issue_id":"localbooru-pad","depends_on_id":"localbooru-eaj","type":"blocks","created_at":"2026-02-04T14:55:01.239230076+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-qzf","title":"Tauri Migration: Python Backend Bridge","description":"Create Tauri commands to spawn and communicate with Python FastAPI backend.\n\n## Context\nLocalBooru's Electron app spawns a Python FastAPI backend process that handles:\n- Image/video metadata extraction\n- Thumbnail generation\n- AI tagging (using ONNX models)\n- Video transcoding (FFmpeg)\n- SVP interpolation (VapourSynth)\n\nThe backend runs on localhost:8787 and the frontend communicates via HTTP API.\n\n## Current Electron Implementation\n- electron/main.js spawns Python process\n- electron/preload.js exposes electronAPI to frontend\n- Frontend uses window.electronAPI for native operations\n\n## Deliverables\n1. Tauri command to spawn Python backend process\n2. Tauri command to check if backend is running\n3. Tauri command to stop backend process\n4. Health check polling until backend is ready\n5. Environment variable passing (paths, ports, etc.)\n\n## Files to Reference\n- electron/main.js - Python process spawning logic\n- api/main.py - FastAPI entry point\n- electron/preload.js - Current IPC API\n\n## Technical Notes\n- Use std::process::Command in Rust to spawn Python\n- Handle process lifecycle (start, monitor, restart, stop)\n- Pass appropriate Python path (system vs bundled)\n- Forward stdout/stderr for debugging\n\n## Success Criteria\n- Python backend auto-starts when Tauri app launches\n- Backend health endpoint responds successfully\n- Backend stops cleanly when app closes\n- Works with both system Python and bundled Python","status":"closed","priority":1,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-04T14:50:51.771354094+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-04T14:55:14.140284147+01:00","closed_at":"2026-02-04T14:55:14.140284147+01:00","close_reason":"Duplicates - using newly created task issues instead","dependencies":[{"issue_id":"localbooru-qzf","depends_on_id":"localbooru-bi6","type":"blocks","created_at":"2026-02-04T14:52:09.178500733+01:00","created_by":"DonutsDelivery"}]}
{"id":"localbooru-s4e","title":"Fix image serving resilience (drive-offline, path healing, thumbnail regen)","description":"Image file serving in v2 lacks several resilience features from v1:\n\nFILE SERVING (routes/images/single.rs):\n- No drive-offline detection: v1 returns 503 when a drive/mount is offline (parent dirs don't exist), v2 always returns 404. Should use file_tracker::check_file_availability() which already exists.\n- No missing file path healing: v1 searches the watch directory for files by filename when stored path is invalid, updates DB if found. v2 returns 404 immediately.\n- No file status DB update on serve: v1 updates file_status/file_exists as a side effect of serving. v2 does no DB update.\n\nTHUMBNAIL SERVING:\n- No thumbnail regeneration on miss: v1 regenerates thumbnail from original file if .webp doesn't exist. v2 returns 404.\n- No drive-offline 503 for thumbnails either.\n\nLEGACY MAIN DB LIST QUERY (routes/images/list.rs):\n- Tags hardcoded to [] instead of fetching from image_tags\n- file_status hardcoded to 'available' instead of reading actual value\n- Missing file_path and directory_name fields in response\n- folder_asc/folder_desc sort values fall through to default 'newest' instead of being handled\n- No access control filtering (public IP should only see images from public_access=true directories)","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:01:31.55209053+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:41:24.999244627+01:00","closed_at":"2026-02-16T12:41:24.999244627+01:00","close_reason":"Closed"}
{"id":"localbooru-sng","title":"Add DB migration system and missing model structs","description":"v2 database layer has structural gaps:\n\n1. NO MIGRATION SYSTEM — v1 has explicit ALTER TABLE ... ADD COLUMN calls wrapped in try/except to safely upgrade existing databases when new columns are added. v2 only has CREATE TABLE IF NOT EXISTS. If a user upgrades from an older schema, new columns won't be added to existing databases. Need a migration system (e.g., version number in a metadata table + sequential ALTER TABLE statements).\n\n2. MISSING MODEL STRUCTS:\n   - BooruInstance — table exists in schema.rs but no Rust struct for deserialization. Needed for booru federation features.\n   - ExternalUpload — table exists but no Rust struct.\n   - DirectoryImageFile — directory DB's image_files table is created correctly, but no dedicated Rust struct. The main ImageFile struct includes watch_directory_id which doesn't exist in directory DBs, making it slightly wrong to reuse.\n\n3. MISSING INDEX — collection_items table has no index on image_id, which affects 'which collections contain this image?' queries. v1 had index=True on image_id.","status":"closed","priority":2,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:11:09.432330733+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:48:33.593099778+01:00","closed_at":"2026-02-16T12:48:33.593099778+01:00","close_reason":"Closed"}
{"id":"localbooru-tbs","title":"Add missing directory maintenance routes (verify, prune, path relocate)","description":"Multiple directory maintenance endpoints exist in v1 Python but are missing from v2 Rust, causing frontend 404s:\n\nMISSING ENDPOINTS:\n- POST /{id}/verify — verify files exist at recorded paths, detect offline drives, delete missing records\n- POST /bulk-verify — verify files across multiple directories at once\n- POST /{id}/prune — move non-favorited images to dumpster folder, preserving structure\n- PATCH /{id}/path — relocate directory when physically moved, update all file path prefixes\n- POST /{id}/clean-deleted — standalone cleanup of deleted files without full rescan\n\nINCOMPLETE EXISTING ENDPOINTS:\n- GET /directories/ list — missing access-level filtering (public IP should only see public_access=true dirs), missing image_count/age_detected_count/pending_tag_tasks fields\n- GET /{id} single — missing image_count, ComfyUI fields (comfyui_prompt_node_ids, comfyui_negative_node_ids)\n- POST /add and POST /add-parent — missing filesystem watcher integration (should call watcher.add_directory)\n- PATCH /{id} update — missing watcher refresh after updating enabled/recursive\n- DELETE /{id} and POST /bulk-delete — missing task queue pause before deletion (race condition), missing watcher removal\n- POST /{id}/scan — missing path-exists validation before queuing task","status":"closed","priority":1,"issue_type":"task","owner":"megusta52@proton.me","created_at":"2026-02-16T12:01:01.933967081+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T12:41:25.001395374+01:00","closed_at":"2026-02-16T12:41:25.001395374+01:00","close_reason":"Closed"}
{"id":"localbooru-tj2","title":"Add Share session subsystem","description":"The entire media sharing/streaming subsystem is missing from v2. Frontend calls 7+ routes under /api/share/* and gets 404:\n\nMISSING ROUTES:\n- POST /api/share/create — create a share session with token\n- DELETE /api/share/{token} — delete a share session\n- POST /api/share/{token}/sync — sync playback state\n- GET /api/share/{token}/info — get share session info\n- GET /api/share/network-info — get network info for sharing\n- GET /api/share/{token}/events — SSE stream for sync events\n- GET /api/share/{token}/hls/playlist.m3u8 — HLS stream for shared media\n\nMISSING SERVICES (from v1):\n- share_session.py — share session lifecycle management\n- share_sync_events (per-token dict) — SSE broadcasters for real-time sync\n\nThis allows sharing media playback across devices on the network.","status":"closed","priority":3,"issue_type":"feature","owner":"megusta52@proton.me","created_at":"2026-02-16T12:08:23.28906524+01:00","created_by":"DonutsDelivery","updated_at":"2026-02-16T13:01:39.158783067+01:00","closed_at":"2026-02-16T13:01:39.158783067+01:00","close_reason":"Closed"}
{"id":"localbooru-yrg","title":"Increase password strength requirements","description":"## Context\nCurrent password validation at `api/routers/users.py:129` and `:193` only requires 4 characters minimum. This is trivially brute-forceable.\n\n## Requirements\n1. Increase minimum password length to 8 characters\n2. Add complexity requirements:\n   - At least one uppercase letter\n   - At least one lowercase letter  \n   - At least one number\n3. Create a shared `validate_password()` function to avoid code duplication\n4. Return helpful error messages explaining what's missing\n\n## Files to modify\n- `api/routers/users.py` - lines 129 and 193 for password validation\n\n## Testing\n- 'password' should fail (no uppercase, no number)\n- 'Password1' should pass\n- 'PASSWORD1' should fail (no lowercase)\n- 'Pass1' should fail (too short)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T18:04:53.282183437+01:00","updated_at":"2026-01-19T18:07:10.655384751+01:00","closed_at":"2026-01-19T18:07:10.655384751+01:00"}
