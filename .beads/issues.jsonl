{"id":"localbooru-0vq","title":"Handle cross-platform path normalization in migration","description":"Ensure paths work across platforms:\n- Normalize path separators in database watch_directories table\n- Handle Windows UNC paths vs Unix paths\n- Convert absolute paths to relative where possible for portability\n- Add option to remap watch directories during migration\n- Store original paths for potential reverse migration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.408874701+01:00","updated_at":"2026-01-16T20:28:35.779210999+01:00","closed_at":"2026-01-16T20:28:35.779210999+01:00","dependencies":[{"issue_id":"localbooru-0vq","depends_on_id":"localbooru-3ov","type":"blocks","created_at":"2026-01-16T20:23:13.672774904+01:00","created_by":"daemon"}]}
{"id":"localbooru-2sb","title":"Add migration tests","description":"Create tests for migration functionality:\n- Unit tests for path detection logic\n- Unit tests for pre-flight checks\n- Integration test: system to portable migration\n- Integration test: portable to system migration\n- Test rollback on simulated failure\n- Test with large data directories\n- Platform-specific path handling tests\n- Mock filesystem tests for CI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.658793674+01:00","updated_at":"2026-01-16T20:34:47.676167952+01:00","closed_at":"2026-01-16T20:34:47.676167952+01:00","dependencies":[{"issue_id":"localbooru-2sb","depends_on_id":"localbooru-7hn","type":"blocks","created_at":"2026-01-16T20:23:14.465960383+01:00","created_by":"daemon"},{"issue_id":"localbooru-2sb","depends_on_id":"localbooru-qya","type":"blocks","created_at":"2026-01-16T20:23:14.474157087+01:00","created_by":"daemon"},{"issue_id":"localbooru-2sb","depends_on_id":"localbooru-8o9","type":"blocks","created_at":"2026-01-16T20:23:14.481787861+01:00","created_by":"daemon"},{"issue_id":"localbooru-2sb","depends_on_id":"localbooru-0vq","type":"blocks","created_at":"2026-01-16T20:23:14.489847954+01:00","created_by":"daemon"},{"issue_id":"localbooru-2sb","depends_on_id":"localbooru-e8h","type":"blocks","created_at":"2026-01-16T20:23:14.498265366+01:00","created_by":"daemon"}]}
{"id":"localbooru-3ov","title":"Create core migration module (api/migration.py)","description":"Create the core migration module with:\n- MigrationDirection enum (to_portable, to_system)\n- MigrationOptions dataclass (include_cache, include_packages, update_watch_dirs)\n- get_migration_source_path() - detect current mode and return source path\n- get_migration_target_path() - calculate target based on direction\n- pre_flight_checks() - verify source exists, check disk space, check db not locked\n- backup_database() - create .backup copy before migration\n- copy_data_directory() - streaming copy with progress callback\n- validate_migration() - run PRAGMA integrity_check on copied db\n- cleanup_source() - optional removal of source after success\n- rollback_migration() - restore from backup on failure","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:05.59565604+01:00","updated_at":"2026-01-16T20:27:05.551092689+01:00","closed_at":"2026-01-16T20:27:05.551092689+01:00","dependencies":[{"issue_id":"localbooru-3ov","depends_on_id":"localbooru-sxr","type":"blocks","created_at":"2026-01-16T20:23:07.814784348+01:00","created_by":"daemon"}]}
{"id":"localbooru-3s9","title":"Add migration API endpoints to routes/settings.py","description":"Add REST endpoints for migration:\n- GET /api/migration/status - returns current mode, source path, estimated size\n- POST /api/migration/start - start migration with direction and options\n- GET /api/migration/progress - poll migration progress (or use WebSocket)\n- POST /api/migration/cancel - cancel in-progress migration\n- POST /api/migration/rollback - rollback failed migration","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:05.874711634+01:00","updated_at":"2026-01-16T20:27:46.138724477+01:00","closed_at":"2026-01-16T20:27:46.138724477+01:00","dependencies":[{"issue_id":"localbooru-3s9","depends_on_id":"localbooru-3ov","type":"blocks","created_at":"2026-01-16T20:23:10.623266459+01:00","created_by":"daemon"}]}
{"id":"localbooru-7hn","title":"Add migration UI to Settings page","description":"Add migration section to frontend/src/pages/SettingsPage.tsx:\n- Show current installation mode (System/Portable)\n- Show current data directory path\n- Show data size breakdown (DB, thumbnails, cache, packages)\n- 'Migrate to Portable' button (when in system mode)\n- 'Migrate to System' button (when in portable mode)\n- Options checkboxes: include cache, include packages\n- Progress bar during migration\n- Success/error feedback with details","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.006229904+01:00","updated_at":"2026-01-16T20:32:45.700528782+01:00","closed_at":"2026-01-16T20:32:45.700528782+01:00","dependencies":[{"issue_id":"localbooru-7hn","depends_on_id":"localbooru-3s9","type":"blocks","created_at":"2026-01-16T20:23:13.949889382+01:00","created_by":"daemon"}]}
{"id":"localbooru-8o9","title":"Implement migration rollback and error recovery","description":"Add robust error handling:\n- Transaction-like behavior: all-or-nothing migration\n- Keep backup until migration validated\n- Automatic rollback on copy failure\n- Manual rollback endpoint for user-initiated recovery\n- Clean up partial copies on failure\n- Log detailed error information for debugging\n- Handle edge cases: disk full mid-copy, permission denied, db locked","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.53353196+01:00","updated_at":"2026-01-16T20:29:25.197016836+01:00","closed_at":"2026-01-16T20:29:25.197016836+01:00","dependencies":[{"issue_id":"localbooru-8o9","depends_on_id":"localbooru-3ov","type":"blocks","created_at":"2026-01-16T20:23:13.51747712+01:00","created_by":"daemon"}]}
{"id":"localbooru-e8h","title":"Add WebSocket progress reporting for migration","description":"Add real-time progress reporting during migration:\n- Create WebSocket endpoint or use existing event system\n- Report: current file being copied, bytes copied, total bytes, percentage\n- Report phase: backup, copying db, copying thumbnails, copying cache, validating\n- Handle client disconnect during migration (continue in background)\n- Send completion or error event when done","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.277654644+01:00","updated_at":"2026-01-16T20:30:30.294767443+01:00","closed_at":"2026-01-16T20:30:30.294767443+01:00","dependencies":[{"issue_id":"localbooru-e8h","depends_on_id":"localbooru-3ov","type":"blocks","created_at":"2026-01-16T20:23:12.570471916+01:00","created_by":"daemon"}]}
{"id":"localbooru-qya","title":"Handle Electron restart after migration","description":"Modify electron/backendManager.js to:\n- Expose IPC method to trigger app restart\n- Handle .use-appdata marker file creation/removal\n- Re-detect portable mode on restart\n- Ensure clean shutdown of Python backend before restart\n- Pass new LOCALBOORU_PORTABLE_DATA value after restart","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:06.148895322+01:00","updated_at":"2026-01-16T20:33:21.90535003+01:00","closed_at":"2026-01-16T20:33:21.90535003+01:00","dependencies":[{"issue_id":"localbooru-qya","depends_on_id":"localbooru-3s9","type":"blocks","created_at":"2026-01-16T20:23:14.336925342+01:00","created_by":"daemon"}]}
{"id":"localbooru-sxr","title":"Add get_system_data_dir() helper to config.py","description":"Add helper function to api/config.py that returns the system data directory path regardless of current mode:\n- Windows: %APPDATA%\\.localbooru\n- Linux: ~/.localbooru\n- macOS: ~/.localbooru\n\nAlso add get_current_mode() to detect if running in portable or system mode.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:21:05.73121922+01:00","updated_at":"2026-01-16T20:25:48.93572396+01:00","closed_at":"2026-01-16T20:25:48.93572396+01:00"}
