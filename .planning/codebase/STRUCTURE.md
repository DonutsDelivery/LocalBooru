# Codebase Structure

**Analysis Date:** 2026-01-15

## Directory Layout

```
localbooru/
├── api/                    # FastAPI Python backend
│   ├── routers/           # API endpoint handlers
│   ├── services/          # Business logic
│   └── middleware/        # Request middleware
├── frontend/              # React SPA
│   ├── src/              # Source code
│   │   └── components/   # React components
│   ├── android/          # Capacitor Android project
│   └── ios/              # Capacitor iOS project
├── electron/              # Desktop app wrapper
├── scripts/               # Build helpers
├── assets/                # Icons, images
├── dist/                  # Packaged builds
├── tagger/                # AI model files (symlink)
└── .planning/             # GSD planning documents
```

## Directory Purposes

**api/**
- Purpose: FastAPI backend server
- Contains: Python modules for API, services, models
- Key files: `main.py` (entry), `models.py` (ORM), `database.py` (connection)
- Subdirectories: `routers/`, `services/`, `middleware/`

**api/routers/**
- Purpose: HTTP endpoint handlers
- Contains: FastAPI router modules
- Key files: `images.py` (1162 lines), `directories.py`, `settings.py`, `network.py`

**api/services/**
- Purpose: Business logic and background processing
- Contains: Service modules
- Key files: `task_queue.py`, `tagger.py`, `directory_watcher.py`, `importer.py`

**frontend/src/**
- Purpose: React application source
- Contains: Components, API client, utilities
- Key files: `App.jsx`, `api.js`, `main.jsx`

**frontend/src/components/**
- Purpose: React UI components
- Contains: JSX components with co-located CSS
- Key files: `Header.jsx`, `Sidebar.jsx`, `Lightbox.jsx`, `MasonryGrid.jsx`

**electron/**
- Purpose: Electron desktop wrapper
- Contains: Main process, backend manager, IPC
- Key files: `main.js` (461 lines), `backendManager.js` (603 lines)

## Key File Locations

**Entry Points:**
- `api/main.py` - FastAPI app startup
- `electron/main.js` - Electron app lifecycle
- `frontend/src/main.jsx` - React bootstrap

**Configuration:**
- `api/config.py` - Backend settings (Pydantic)
- `frontend/vite.config.js` - Vite build config
- `frontend/capacitor.config.ts` - Mobile config
- `package.json` - Electron-builder config

**Core Logic:**
- `api/services/task_queue.py` - Background job processing
- `api/services/tagger.py` - AI image tagging (655 lines)
- `api/routers/images.py` - Image CRUD operations
- `frontend/src/api.js` - HTTP client

**Database:**
- `api/models.py` - SQLAlchemy ORM models
- `api/database.py` - Connection, migrations

**Testing:**
- No test directories or files present

**Documentation:**
- `README.md` - User documentation
- `frontend/DESIGN.md` - Frontend design spec

## Naming Conventions

**Files:**
- Python: `snake_case.py` (task_queue.py, directory_watcher.py)
- React components: `PascalCase.jsx` (Header.jsx, Lightbox.jsx)
- JS utilities: `camelCase.js` (api.js, serverManager.js)
- CSS: `PascalCase.css` matching component (Header.css)

**Directories:**
- All lowercase with underscores where needed
- Plural for collections: `routers/`, `services/`, `components/`

**Special Patterns:**
- `__init__.py` for Python packages
- Co-located CSS with components (Header.jsx + Header.css)

## Where to Add New Code

**New API Endpoint:**
- Router: `api/routers/{resource}.py`
- Service logic: `api/services/{service}.py`
- Models if needed: `api/models.py`

**New React Component:**
- Implementation: `frontend/src/components/{ComponentName}.jsx`
- Styles: `frontend/src/components/{ComponentName}.css`

**New Background Task:**
- Task handler: `api/services/task_queue.py`
- Task type enum: `api/models.py` (TaskType)

**New Service:**
- Implementation: `api/services/{service_name}.py`
- Import in: `api/main.py` if needs startup

**Utilities:**
- Frontend: `frontend/src/` (no utils/ dir)
- Backend: `api/` or `api/services/`

## Special Directories

**tagger/**
- Purpose: AI model files for image tagging
- Source: Symlink to external model directory
- Committed: No (symlink only)

**dist/**
- Purpose: Packaged Electron builds
- Source: Generated by electron-builder
- Committed: No (build artifacts)

**.planning/**
- Purpose: GSD planning documents
- Source: Codebase mapping and planning
- Committed: Yes

---

*Structure analysis: 2026-01-15*
*Update when directory structure changes*
